<!DOCTYPE html>
<html lang="en">
<head>
    <title>Student reservations</title>
    <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css.css">
    <script type="module" src="API.js"></script>
</head>

<body>
    <div class="col-12">
        <button onclick="window.location.href='student.html'" id="backBtn">Back</button>
    </div>
   
    <div class="content">
        <h1>Reserve Books</h1>

        <div class="book-sections">
            <form id="libraryForm">

                <div class="borrowed-books">
                    <h2>Borrowed Books</h2>
                    <ul id="borrowedBooksList">
                        <table id="booksTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>ISBN</th>
                                    <th>Author</th>
                                    <th>Title</th>
                                    <th>Category</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr data-id="1000">
                                    <td>1000</td>
                                    <td>123456789</td>
                                    <td>J.K. Rowling</td>
                                    <td>Harry Potter and the Sorcerer's Stone</td>
                                    <td>Fantasy</td>
                                    <td>In possession</td>
                                    <td>
                                        <label><input type="checkbox">Declare Return Intent</label>
                                    </td>
                                </tr>
                                <tr data-id="2000">
                                    <td>2000</td>
                                    <td>123456783</td>
                                    <td>George Orwell</td>
                                    <td>1984</td>
                                    <td>Dystopian</td>
                                    <td>Reserved</td>
                                    <td>
                                        <label><input type="checkbox">Cancel Reservation</label>
                                    </td>
                                </tr>
                                <tr data-id="3000">
                                    <td>3000</td>
                                    <td>234567890</td>
                                    <td>J.R.R. Tolkien</td>
                                    <td>Hobbit</td>
                                    <td>Fantasy</td>
                                    <td>In possession (return intent declared)</td>
                                    <td>
                                        <label><input type="checkbox">Cancel Return Intent</label>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <!-- Borrowed books will be populated here -->
                    </ul>
                </div>

                <div class="available-books">
                    <h2>Available Books</h2>
                    <ul id="availableBooksList">
                        <table id="booksTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>ISBN</th>
                                    <th>Author</th>
                                    <th>Title</th>
                                    <th>Category</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr data-id="1000">
                                    <td>1000</td>
                                    <td>123456789</td>
                                    <td>J.K. Rowling</td>
                                    <td>Harry Potter and the Sorcerer's Stone</td>
                                    <td>Fantasy</td>
                                    <td>Available</td>
                                    <td>
                                        <label><input type="checkbox">Reserve</label>
                                    </td>
                                </tr>
                                <tr data-id="2000">
                                    <td>2000</td>
                                    <td>123456783</td>
                                    <td>George Orwell</td>
                                    <td>1984</td>
                                    <td>Dystopian</td>
                                    <td>No free copies available</td>
                                    <td>
                                        <label><input type="checkbox">Reserve</label>
                                    </td>
                                </tr>
                                <tr data-id="3000">
                                    <td>3000</td>
                                    <td>234567890</td>
                                    <td>J.R.R. Tolkien</td>
                                    <td>Hobbit</td>
                                    <td>Fantasy</td>
                                    <td>Unavailable</td>
                                    <td>
                                        <label><input type="checkbox" disabled>Reserve</label>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <!-- Available books will be populated here -->
                    </ul>
                </div>

                <button type="submit" id="reserveBooksBtn">Save</button>
            </form>
        </div>

    </div>


    <!--Scripts (gpt)-->
    <script type="module">
        import FrontEndAPI from './API.js';

        const api = new FrontEndAPI('/api'); // Adjust the path as necessary
        const studentId = 'example-student-id'; // Replace with actual student ID

        // Load borrowed books
        async function loadBorrowedBooks() {
            try {
                const borrowedBooks = await api.getBorrowedBooks(studentId); // Adjust the API method as necessary
                const borrowedBooksList = document.getElementById('borrowedBooksList');
                borrowedBooksList.innerHTML = '';
                borrowedBooks.forEach(book => {
                    const listItem = document.createElement('li');
                    listItem.innerHTML = `<input type="checkbox" name="borrowedBooks" value="${book.id}"> ${book.title} by ${book.author}`;
                    borrowedBooksList.appendChild(listItem);
                });
            } catch (error) {
                console.error('Error loading borrowed books:', error);
            }
        }

        // Load available books
        async function loadAvailableBooks() {
            try {
                const availableBooks = await api.getAvailableBooks(); // Adjust the API method as necessary
                const availableBooksList = document.getElementById('availableBooksList');
                availableBooksList.innerHTML = '';
                availableBooks.forEach(book => {
                    const listItem = document.createElement('li');
                    listItem.innerHTML = `<input type="checkbox" name="availableBooks" value="${book.id}"> ${book.title} by ${book.author}`;
                    availableBooksList.appendChild(listItem);
                });
            } catch (error) {
                console.error('Error loading available books:', error);
            }
        }

        // Handle return books form submission
        document.getElementById('borrowedBooksForm').addEventListener('submit', async (event) => {
            event.preventDefault();

            const checkedBoxes = document.querySelectorAll('input[name="borrowedBooks"]:checked');
            const bookIds = Array.from(checkedBoxes).map(box => box.value);

            try {
                const response = await api.returnBookItems(studentId, bookIds); // Adjust the API method as necessary
                alert(response.message);
                loadBorrowedBooks(); // Refresh the list of borrowed books
            } catch (error) {
                console.error('Error returning books:', error);
                alert('Failed to return books. Please try again.');
            }
        });

        // Handle reserve books form submission
        document.getElementById('availableBooksForm').addEventListener('submit', async (event) => {
            event.preventDefault();

            const checkedBoxes = document.querySelectorAll('input[name="availableBooks"]:checked');
            const bookIds = Array.from(checkedBoxes).map(box => box.value);

            try {
                const response = await api.reserveBooks(studentId, bookIds); // Adjust the API method as necessary
                alert(response.message);
                loadAvailableBooks(); // Refresh the list of available books
                loadBorrowedBooks(); // Refresh the list of borrowed books
            } catch (error) {
                console.error('Error reserving books:', error);
                alert('Failed to reserve books. Please try again.');
            }
        });

        // Initialize the page
        loadBorrowedBooks();
        loadAvailableBooks();
    </script>

</body>
</html>